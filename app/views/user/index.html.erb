<style>
  .current-user {  
    display: flex;  
    flex-direction: column;
  }
  .user-avatar {  
    width: 100px; /* Set consistent width */  
    height: 100px; /* Set consistent height */  
    object-fit: cover; /* Ensures the image fills the space without distortion */  
    border-radius: 50%; /* Optional: Makes the image circular */  
    border: 2px solid #ccc; /* Optional border */
  }

  .account-buttons {
    margin-left: 100px;
  }
</style>

<div id="account-menu">
  <div class="current-user">    
    <% if current_user.profile_picture.attached? %>        
      <%= image_tag url_for(current_user.profile_picture), alt: "User Avatar", class: "user-avatar" %>    
    <% else %>        
      <p>No avatar uploaded.</p>    
    <% end %>    
    <%= current_user.username %>
  </div>
  <div class="account-buttons">
    <%= link_to "Logout", logout_path, method: :get, class: "account-logout-button" %>
    <%= link_to "Menu", games_path, class: "account-menu-button" %>
    <%= link_to "Inventory", inventory_index_path, class: "account-inventory-button" %>
  </div>

  <div class="account-sections">
    <div class="user-stats-container">
      <% if current_user.current_skin %>
        <% current_skin = current_user.current_skin %>
        <% if current_skin.image.attached? %>
          <%= image_tag(current_skin.image, width: 100, height: 100, alt: "Skin Image") %>
        <% else %>
          <p>No image available for the current skin.</p>
        <% end %>
        <div class="account-stats">
          <span class="account-stats-name">Archetype:</span>
          <span class="account-stats-value"><%= current_skin.archetype %></span>
        </div>
        <div class="account-stats">
          <span class="account-stats-name">Max Health:</span>
          <span class="account-stats-value"><%= current_skin.health %></span>
        </div>
        <div class="account-stats">
          <span class="account-stats-name">Max Mana:</span>
          <span class="account-stats-value"><%= current_skin.mana %></span>
        </div>
        <div class="account-stats">
          <span class="account-stats-name">Attack:</span>
          <span class="account-stats-value"><%= current_skin.attack %></span>
        </div>
        <div class="account-stats">
          <span class="account-stats-name">Special Attack:</span>
          <span class="account-stats-value"><%= current_skin.special_attack %></span>
        </div>
        <div class="account-stats">
          <span class="account-stats-name">Defense:</span>
          <span class="account-stats-value"><%= current_skin.defense %></span>
        </div>
        <div class="account-stats">
          <span class="account-stats-name">Special Defense:</span>
          <span class="account-stats-value"><%= current_skin.special_defense %></span>
        </div>
        <div class="account-stats">
          <span class="account-stats-name">IQ:</span>
          <span class="account-stats-value"><%= current_skin.iq %></span>
        </div>
        <div class="account-stats">
          <span class="account-stats-name">Level:</span>
          <span class="account-stats-value"><%= current_skin.level %></span>
        </div>
        <div class="account-stats">
          <span class="account-stats-name">Experience:</span>
          <span class="account-stats-value"><%= current_skin.experience %></span>
        </div>
      <% else %>
        <p>No active skin selected. Please select a skin in your inventory.</p>
      <% end %>
    </div>

    <div id="user-search-container">
      <h3>Search for Users</h3>
      <%= form_tag account_path, method: :get, class: "search-form" do %>
        <div>
          <%= label_tag :search, "Search Users:" %>
          <%= text_field_tag :search, params[:search], placeholder: "Enter username" %>
        </div>
        <%= submit_tag "Search", class: "button" %>
      <% end %>

      <div id="users-list-container">
        <h3>Search Results</h3>
        <% if @users.present? %>
          <ul>
            <% @users.each do |user| %>
              <li>
                <span><strong>Username:</strong> <%= user.username %></span>
                <% if current_user.friends.include?(user) %>
                  <%= button_to "Remove Friend", remove_friend_path(friend_id: user.id), method: :delete, class: "button remove-friend-button" %>
                <% else %>
                  <%= button_to "Add Friend", add_friend_path(friend_id: user.id), method: :post, class: "button add-friend-button" %>
                <% end %>
              </li>
            <% end %>
          </ul>
        <% else %>
          <p>No users found matching your search.</p>
        <% end %>
      </div>
    </div>

    <div id="vertical-container">
      <div id="friends-list-container">
        <h3>Your Friends</h3>
        <% if current_user.friends.present? %>
          <ul>
            <% current_user.friends.each do |friend| %>
              <li>
                <span><strong>Username:</strong> <%= friend.username %></span>
                <%= form_tag chat_with_user_path, method: :get, class: "inline-form" do %>
                  <%= hidden_field_tag :friend_id, friend.id %>
                  <%= submit_tag "Chat", class: "button chat-button" %>
                <% end %>
                <%= button_to "Remove Friend", remove_friend_path(friend_id: friend.id), method: :delete, class: "button remove-friend-button" %>
              </li>
            <% end %>
          </ul>
        <% else %>
          <p>You have no friends yet.</p>
        <% end %>
      </div>

      <div id="achievements-list-container">
        <h3>Achievements</h3>
        <% if @achievements.present? %>
          <ul>
            <% @achievements.each do |achievement| %>
              <li>
                <span><%= achievement %></span>
              </li>
            <% end %>
          </ul>
        <% else %>
          <p>You have no achievements yet.</p>
        <% end %>
      </div>
    </div>
  </div>
</div>
