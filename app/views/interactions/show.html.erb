<div class="interaction-page">
  <h1>Interaction with Enemy</h1>
  <p>Your position: (<%= @game_user.x_position %>, <%= @game_user.y_position %>)</p>

  <!-- Display enemy stats -->
  <div class="enemy-info">
    <h3><%= @enemy.name %></h3>
    <p>Health: <span id="enemy-health"><%= @enemy.health %></span></p>
    <p>Attack: <%= @enemy.attack %></p>
    <p>Defense: <%= @enemy.defense %></p>
    <p>IQ: <%= @enemy.iq %></p>
    <p id="attack-message"></p>
  </div>

  <!-- Attack Button -->
  <button id="attack-button" data-game-id="<%= @game.code %>">Attack</button>

  <div class="interaction-footer">
    <%= link_to 'Return to Grid', grid_path, class: 'back-button' %>
  </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const attackButton = document.getElementById('attack-button');
        const enemyHealthDisplay = document.getElementById('enemy-health');
        const attackMessage = document.getElementById('attack-message');

        attackButton.addEventListener('click', () => {
            const gameId = attackButton.getAttribute('data-game-id');
            fetch(`/interactions/${gameId}/attack`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRF-Token': document.querySelector('[name="csrf-token"]').content
                },
                body: JSON.stringify({ game_id: gameId })
            })
                .then(response => response.json())
                .then(data => {
                    enemyHealthDisplay.textContent = data.enemy_health;
                    attackMessage.textContent = data.message;

                    // Disable the attack button if the enemy is defeated
                    if (data.message === "You win!") {
                        attackButton.disabled = true;
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        });
    });
</script>
